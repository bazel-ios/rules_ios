load("@rules_python//python:defs.bzl", "py_library")
load("lldb_test.bzl", "lldb_test")

# Consider structuring the tests into "infra" rules and leaving thse here
lldb_test(
    name = "objc_app_test",
    application = "//tests/ios/app:App",
    breakpoint_cmd = "breakpoint set --file 'tests/ios/app/App/main.m' --line 6",
    expected_value = "some",

    # Manual for now, and run on a different shard
    tags = ["manual"],
    variable = "x",
)

## Infra definitions
# Re-use rules apple sim creation and running code path
py_library(
    name = "ios_sim_template_lib",
    srcs = [
        "sim_template",
    ],
)

# Wrap this to feed into py_library - doesn't like the name with the dot in it
genrule(
    name = "sim_template",
    srcs = ["@build_bazel_rules_apple//apple/internal/templates:ios_sim_template"],
    outs = ["sim_template.py"],
    cmd = "cp $(SRCS) $(OUTS)",
)

py_library(
    name = "lldb_test",
    srcs = [
        "breakpoint.py",
        "lldb_test.py",
    ],
    deps = [
        ":ios_sim_template_lib",
    ],
)
